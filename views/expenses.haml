:javascript

  function refreshExpensesListAndTotal(data) {
    var total_amount = data.substring(0, data.indexOf(':'));
    var expenses_html = data.substring(data.indexOf(':') + 1);
    $('#sum-amount').html(total_amount);
    $('#expenses-list').html(expenses_html);
  }

  $(document).ready(function() {
    $('.expense_tag').click(function() {
      $(this).toggleClass('selected_tag');
      var selected_tags = Array();
      $.each($('.selected_tag'), function() { selected_tags.push($(this).attr('id')); });
      $.get("/get_expenses", { "tags[]" : $.makeArray(selected_tags) }, function(data) {
        refreshExpensesListAndTotal(data);
        // bind the onclick action to the newly inserted row
        $("a.delete").bind("click", function() {
          $.delete_("/expenses/" + this.id, {}, function(data){
            var expense_id = data.substring(0, data.indexOf(':'));
            var expense_amount = data.substring(data.indexOf(':') + 1);
            $("a#"+data).parents("li.expense").hide();
            var old_total = $("#sum-amount").html();
            $("#sum-amount").html(old_total - parseInt(expense_amount));
          })
        });
      });
    });
  })

%h1= "Expenses for #{current_user.name}"
#tags
  = partial :tag, :collection => @tags
#expenses
  %ul#expenses-list
    / = partial :expense, :collection => @expenses
#sum
  #sum-text Total amount:
  #sum-amount 0

%div
  %a{ :href => '/expenses/new' } New expense